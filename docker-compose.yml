services:
  wt2xt:

    image: wt2xt
    build:
      context: .

    ports:
      - "3000:3000"
    volumes:
      - ./templates:/app/templates
      - ./out:/app/out:rw
      - ./tmp:/app/tmp:rw
      - ./config:/app/config
    networks:
      - frontend
    # Run the API server by default
    command: api
    user: "1001:1001"  # Use the non-root user created in the Dockerfile

    # To run the CLI tool instead, use:
    # docker-compose run --rm wt2xt --web-template=./templates/example.json --export-format=adoc

    # Ensure host directories exist with proper permissions before starting
    # This helps with Linux permission issues
networks:
  frontend:
    external: true
